<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Montag, September 01, 2025, 2:17  -->
<!-- MuClient version 5.06 -->

<!-- Plugin "updater" generated by Plugin Wizard -->

<muclient>
<plugin
   name="updater"
   author="Atlan"
   id="9e0c3483a4251f4092ce8522"
   language="Lua"
   purpose="updater for the soundpack"
   date_written="2025-09-01 14:16:22"
   requires="5.06"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   match="You have regained balance."
   sequence="100"
  >
  <send>prepare arcaleaf</send>
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
-- update_check.lua
-- Prüft automatisch, ob eine neue Version des Mystavaria-Soundpacks verfügbar ist

local http = require("socket.http")
local ltn12 = require("ltn12")

-- Pfad zu deiner lokalen version.info
local Workspace = "D:\\spiele\\mystavaria\\mystavaria\\"  -- anpassen
local versionFile = Workspace.."version.info"

-- lokale Version einlesen
local version_file = io.open(versionFile, "r")
if not version_file then
    Execute("tts_interrupt Could not read local version.info!")
    return
end
local localVersion = version_file:read("*a")
version_file:close()
SetVariable("version", localVersion)

-- URL zur Online-Version (Raw-Link von GitHub)
local url = "https://github.com/derbruedi/mystavaria-soundpack/raw/refs/heads/main/mystavaria/version.info"

-- Funktion, die die Online-Version abfragt
function CheckForUpdates()
    local response = {}
    local r, c = http.request{
        url = url,
        sink = ltn12.sink.table(response)
    }

    if c == 200 then
        local onlineVersion = table.concat(response)
        onlineVersion = onlineVersion:gsub("%s+", "")  -- Leerzeichen und Zeilenumbrüche entfernen
        if onlineVersion ~= localVersion then
            Execute("tts_interrupt Update available! Local: "..localVersion..", Latest: "..onlineVersion)
        else
            Execute("tts_interrupt Mystavaria Soundpack is up to date. Version: "..localVersion)
        end
    else
        Execute("tts_interrupt Could not check for updates. HTTP code: "..tostring(c))
    end
end

-- beim Start aufrufen
CheckForUpdates()

]]>
</script>


</muclient>
